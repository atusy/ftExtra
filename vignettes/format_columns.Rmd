---
title: "Format columns"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Format columns}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces how to format columns in flextable.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = rmarkdown::pandoc_available() && ("dplyr" %in% rownames(installed.packages()))
)
```

```{r setup}
library(ftExtra)
```

# Treat character columns as markdown columns

The example below shows that `colformat_md()` function parses markdown texts in the flextable object.

```{r}
data.frame(
  a = c("**bold**", "*italic*"),
  b = c("^superscript^", "~subscript~"),
  c = c("`code`", "[underline]{.underline}"),
  d = c("*[**~ft~^Extra^**](https://ftextra.atusy.net/) is*",
        "[Cool]{.underline shading.color='skyblue'}"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md()
```

The table header can also be formatted by specifying `part = "header"` or `"all"` to `colformat_md()`

Supported syntax are

- **bold**
- *italic*
- `code`
- ^superscript^
- ~subscript~
- link
- footnote
- image
- line break
- citations
- attributes with Span, Link, Code, and so on
    - to underline: `[foo]{.underline})`
    - to color: `[foo]{color=red}`
    - to highlight: `[foo]{shading.color=gray}`
    - to change font: `[foo]{font.family=Roboto}`
    - and the combinations of the above

Note that other syntax may result in unexpected behaviors.
The **ftExtra** package does not support multiple paragraphs or block elements other than the paragraph.

## Footnotes

Currently footnotes have some limitations.

- A cell allows up to one footnote.
- A footnote needs be added at the end of the cell.

For example,

```{r}
data.frame(
  package = "ftExtra",
  description = "Extensions for 'Flextable'^[Supports of footnotes]"
) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit(add_w = 0.5)
```

Reference symboles can be configured by `footnote_options()`.
Of course, markdown can be used inside footnotes as well.

```{r}
data.frame(
  package = "ftExtra^[Short of *flextable extra*]",
  description = "Extensions for 'Flextable'^[Supports of footnotes]"
) %>%
  as_flextable() %>%
  colformat_md(
    .footnote_options = footnote_options(ref = "i",
                                         prefix = '[',
                                         suffix = ']',
                                         start = 2,
                                         inline = TRUE,
                                         sep = "; ")
  ) %>%
  flextable::autofit(add_w = 0.5)
```


## Images

Images can be inserted optionally with width and/or height attributes.
Specifying one of them changes the other while keeping the aspect ratio.

```{r}
data.frame(
  R = c("![](https://www.r-project.org/logo/Rlogo.png){width=.5} is the great language"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit()
```

The R logo is distributed by The R Foundation with the [CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.

## Line breaks

By default, soft line breaks becomes spaces.

```{r}
data.frame(linebreak = c("a\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md()
```

Pandoc's markdown supports hard line breaks by adding a backslash or double spaces at the end of a line.

```{r}
data.frame(linebreak = c("a\\\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md()
```

It is also possible to make `\n` as a hard line break by extending Pandoc's Markdown.

```{r}
data.frame(linebreak = c("a\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md(.from = "markdown+hard_line_breaks")
```

## Citations

Citations is experimentally supported.
Note that there are no citation lists.
It is expected to be produced by using R Markdown.

```{r}
bib <- tempfile(fileext = ".bib")

writeLines(
"
@Manual{R-base,
  title = {R: A Language and Environment for Statistical
    Computing},
  author = {{R Core Team}},
  organization = {R Foundation for Statistical Computing},
  address = {Vienna, Austria},
  year = {2020},
  url = {https://www.R-project.org/},
}
", bib
)

data.frame(
  Cite = c("@R-base", "[@R-base]", "[-@R-base]")
) %>%
  as_flextable() %>%
  colformat_md(.pandoc_args = paste0("--bibliography=", bib)) %>%
  flextable::autofit()
```


## Emoji

Pandoc's markdown provides an extension, `emoji`.
To use it with `colformat_md()`, specify `.extensions="+emoji"`.

```{r}
data.frame(emoji = c(":+1:"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md(.extensions = "+emoji")
```
