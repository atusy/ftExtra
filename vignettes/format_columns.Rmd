---
title: "Format columns as markdown"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Format columns as markdown}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette introduces how to format columns in flextable.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = rmarkdown::pandoc_available("2.7.2") &&
    ("dplyr" %in% rownames(installed.packages()))
)
```

```{r setup}
library(ftExtra)
```

# Basic examples

The example below shows that `colformat_md()` function parses markdown texts in the flextable object.

```{r}
data.frame(
  a = c("**bold**", "*italic*"),
  b = c("^superscript^", "~subscript~"),
  c = c("`code`", "[underline]{.underline}"),
  d = c("*[**~ft~^Extra^**](https://ftextra.atusy.net/) is*",
        "[Cool]{.underline shading.color='skyblue'}"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md()
```

The table header can also be formatted by specifying `part = "header"` or `"all"` to `colformat_md()`

Supported syntax are

- **bold**
- *italic*
- `code`
- ^superscript^
- ~subscript~
- link
- footnote
- image
- line break
- citations
- attributes with Span, Link, Code, and so on
    - to underline: `[foo]{.underline})`
    - to color: `[foo]{color=red}`
    - to highlight: `[foo]{shading.color=gray}`
    - to change font: `[foo]{font.family=Roboto}`
    - and the combinations of the above

Note that other syntax may result in unexpected behaviors.
The **ftExtra** package does not support multiple paragraphs or block elements other than the paragraph.

## Footnotes

Currently footnotes have some limitations.

- A cell allows up to one footnote.
- A footnote needs be added at the end of the cell.

For example,

```{r}
data.frame(
  package = "ftExtra",
  description = "Extensions for 'Flextable'^[Supports of footnotes]",
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit(add_w = 0.5)
```

Reference symboles can be configured by `footnote_options()`.
Of course, markdown can be used inside footnotes as well.

```{r}
data.frame(
  package = "ftExtra^[Short of *flextable extra*]",
  description = "Extensions for 'Flextable'^[Supports of footnotes]"
) %>%
  as_flextable() %>%
  colformat_md(
    .footnote_options = footnote_options(ref = "i",
                                         prefix = '[',
                                         suffix = ']',
                                         start = 2,
                                         inline = TRUE,
                                         sep = "; ")
  ) %>%
  flextable::autofit(add_w = 0.5)
```


# Images

Images can be inserted optionally with width and/or height attributes.
Specifying one of them changes the other while keeping the aspect ratio.

```{r}
data.frame(
  R = c("![](https://www.r-project.org/logo/Rlogo.png){width=.5} is the great language"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit()
```

The R logo is distributed by The R Foundation with the [CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.

# Line breaks

By default, soft line breaks becomes spaces.

```{r}
data.frame(linebreak = c("a\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md()
```

Pandoc's markdown supports hard line breaks by adding a backslash or double spaces at the end of a line.

```{r}
data.frame(linebreak = c("a\\\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md()
```

It is also possible to make `\n` as a hard line break by extending Pandoc's Markdown.

```{r}
data.frame(linebreak = c("a\nb"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md(md_extensions = "+hard_line_breaks")
```

# Citations

Citations is experimentally supported.
Note that there are no citation lists.
It is expected to be produced by using R Markdown.

First, create a `ftExtra.bib` file like below.

```{r, echo=FALSE, collapse=FALSE, out.class="bib", warning=FALSE}
knitr::write_bib("ftExtra")
```

Second, specify it within the YAML front matter.
It may also be required to cite references in the `nocite` field.

```yaml
---
bibliography: ftExtra.bib
nocite: @R-ftExtra
---
```

Finally, cite the references within tables.

```{r, eval=FALSE}
data.frame(
  Cite = c("@R-ftExtra", "[@R-ftExtra]", "[-@R-ftExtra]"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit(add_w = 0.2)
```

```{r, echo=FALSE, warning=FALSE}
tf <- tempfile(fileext = ".bib")
knitr::write_bib("ftExtra", tf)
data.frame(
  Cite = c("@R-ftExtra", "[@R-ftExtra]", "[-@R-ftExtra]"),
  stringsAsFactors = FALSE
) %>%
  as_flextable() %>%
  colformat_md(pandoc_args = paste0("--bibliography=", tf)) %>%
  flextable::autofit(add_w = 0.2)
```

# Math

The rendering of math is also possible.

```{r}
data.frame(math = "$e^{i\\theta} = \\cos \\theta + i \\sin \\theta$",
           stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md() %>%
  flextable::autofit(add_w = 0.2)
```

Note that results can be insufficient.
This feature relies on Pandoc's HTML writer, which

> render TeX math as far as possible using Unicode characters \
> https://pandoc.org/MANUAL.html#math-rendering-in-html

# Emoji

Pandoc's markdown provides an extension, `emoji`.
To use it with `colformat_md()`, specify `md_extensions="+emoji"`.

```{r}
data.frame(emoji = c(":+1:"), stringsAsFactors = FALSE) %>%
  as_flextable() %>%
  colformat_md(md_extensions = "+emoji")
```
